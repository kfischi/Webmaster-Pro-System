<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebMaster Pro - אדיטור ויזואלי מתקדם</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #059669;
            --accent: #f59e0b;
            --error: #dc2626;
            --warning: #f59e0b;
            --success: #059669;
            --info: #0891b2;
            
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --bg-dark: #1e293b;
            --bg-darker: #0f172a;
            
            --text-dark: #1e293b;
            --text-medium: #64748b;
            --text-light: #94a3b8;
            --text-white: #ffffff;
            
            --border: #e2e8f0;
            --border-strong: #cbd5e1;
            
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            --gradient-main: linear-gradient(135deg, #2563eb 0%, #059669 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Assistant', sans-serif;
            background: var(--bg-main);
            color: var(--text-dark);
            line-height: 1.6;
            overflow: hidden;
        }

        /* ===== MAIN LAYOUT ===== */
        .editor-container {
            display: flex;
            height: 100vh;
            flex-direction: column;
        }

        /* ===== TOP BAR ===== */
        .top-bar {
            background: var(--bg-dark);
            color: var(--text-white);
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .top-bar-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo-mini {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
        }

        .logo-icon-mini {
            width: 35px;
            height: 35px;
            background: var(--gradient-main);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: bold;
        }

        .website-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .website-select {
            background: var(--bg-darker);
            border: 1px solid var(--border-strong);
            color: var(--text-white);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            min-width: 200px;
        }

        .editing-indicator {
            background: var(--success);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .supabase-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background: var(--bg-darker);
            border: 1px solid var(--border-strong);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--error);
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: var(--success);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .top-btn {
            background: transparent;
            border: 1px solid var(--border-strong);
            color: var(--text-white);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .top-btn.primary {
            background: var(--primary);
            border-color: var(--primary);
        }

        .top-btn.success {
            background: var(--success);
            border-color: var(--success);
        }

        .top-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .top-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== MAIN EDITOR AREA ===== */
        .editor-main {
            display: flex;
            flex: 1;
            height: calc(100vh - 60px);
        }

        /* ===== LEFT SIDEBAR ===== */
        .left-sidebar {
            width: 320px;
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .sidebar-tabs {
            display: flex;
            background: var(--bg-main);
            border-bottom: 1px solid var(--border);
        }

        .sidebar-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .sidebar-tab.active {
            background: var(--bg-card);
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .sidebar-content {
            flex: 1;
            padding: 1.5rem;
        }

        .section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* ===== COLOR PICKER ===== */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .color-option {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .color-option.active {
            border-color: var(--text-dark);
            transform: scale(1.1);
            box-shadow: var(--shadow);
        }

        .color-option::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .color-option.active::after {
            opacity: 1;
        }

        /* ===== SERVICES MANAGER ===== */
        .services-list {
            margin-top: 1rem;
        }

        .service-item {
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .service-item:hover {
            box-shadow: var(--shadow);
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .service-name {
            font-weight: 600;
            color: var(--text-dark);
            flex: 1;
        }

        .service-actions {
            display: flex;
            gap: 0.5rem;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .icon-btn.edit {
            background: var(--warning);
            color: white;
        }

        .icon-btn.delete {
            background: var(--error);
            color: white;
        }

        .icon-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow);
        }

        .service-price {
            font-weight: 600;
            color: var(--success);
            font-size: 0.9rem;
        }

        .add-service-btn {
            width: 100%;
            padding: 1rem;
            border: 2px dashed var(--border);
            background: transparent;
            border-radius: 12px;
            cursor: pointer;
            color: var(--text-medium);
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .add-service-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        /* ===== CENTER PREVIEW ===== */
        .center-preview {
            flex: 1;
            background: var(--bg-main);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .preview-toolbar {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .device-controls {
            display: flex;
            gap: 1rem;
        }

        .device-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            background: white;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .device-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .preview-actions {
            display: flex;
            gap: 0.5rem;
        }

        .preview-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            background: white;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .preview-btn:hover {
            background: var(--bg-main);
        }

        .preview-container {
            flex: 1;
            padding: 2rem;
            overflow: auto;
            position: relative;
        }

        .preview-frame {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            transition: all 0.3s ease;
            border: 2px solid var(--border);
        }

        .preview-frame.mobile {
            max-width: 375px;
        }

        .preview-frame.tablet {
            max-width: 768px;
        }

        .preview-content {
            min-height: 600px;
            padding: 2rem;
        }

        /* ===== RIGHT SIDEBAR ===== */
        .right-sidebar {
            width: 300px;
            background: var(--bg-card);
            border-left: 1px solid var(--border);
            overflow-y: auto;
            padding: 1.5rem;
        }

        .stats-section {
            margin-bottom: 2rem;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
        }

        .stat-label {
            color: var(--text-medium);
            font-size: 0.9rem;
        }

        .stat-value {
            font-weight: 600;
            color: var(--text-dark);
        }

        /* ===== LOADING ===== */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== SUCCESS/ERROR MESSAGES ===== */
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            z-index: 10000;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }

        .message.success {
            background: var(--success);
            color: white;
        }

        .message.error {
            background: var(--error);
            color: white;
        }

        .message.warning {
            background: var(--warning);
            color: white;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .left-sidebar {
                width: 280px;
            }
            
            .right-sidebar {
                width: 250px;
            }
        }

        @media (max-width: 968px) {
            .editor-main {
                flex-direction: column;
            }
            
            .left-sidebar,
            .right-sidebar {
                width: 100%;
                height: auto;
                max-height: 300px;
            }
            
            .top-bar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
        }

        /* ===== SUPABASE CONFIG MODAL ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .modal {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-medium);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .btn-secondary {
            background: var(--bg-main);
            color: var(--text-dark);
            border: 1px solid var(--border);
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="top-bar-left">
                <div class="logo-mini">
                    <div class="logo-icon-mini">WM</div>
                    <span>WebMaster Pro Editor</span>
                </div>
                
                <div class="website-selector">
                    <select class="website-select" id="websiteSelector" onchange="loadWebsiteForEditing(this.value)">
                        <option value="">בחר אתר לעריכה...</option>
                    </select>
                    
                    <div class="editing-indicator" id="editingIndicator" style="display: none;">
                        <i class="fas fa-edit"></i>
                        <span>עורך: <span id="currentWebsiteName">-</span></span>
                    </div>
                </div>

                <div class="supabase-status" id="supabaseStatus">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">לא מחובר</span>
                </div>
            </div>
            
            <div class="top-bar-right">
                <button class="top-btn" onclick="showSupabaseConfig()">
                    <i class="fas fa-database"></i>
                    הגדרות DB
                </button>
                <button class="top-btn" onclick="undoChanges()" disabled>
                    <i class="fas fa-undo"></i>
                    ביטול
                </button>
                <button class="top-btn" onclick="redoChanges()" disabled>
                    <i class="fas fa-redo"></i>
                    חזרה
                </button>
                <button class="top-btn success" onclick="saveWebsite()" disabled>
                    <i class="fas fa-save"></i>
                    שמור
                </button>
                <button class="top-btn primary" onclick="previewWebsite()" disabled>
                    <i class="fas fa-eye"></i>
                    תצוגה מקדימה
                </button>
                <button class="top-btn" onclick="exportWebsite()" disabled>
                    <i class="fas fa-download"></i>
                    ייצא
                </button>
            </div>
        </div>

        <!-- Main Editor Area -->
        <div class="editor-main">
            <!-- Left Sidebar -->
            <div class="left-sidebar">
                <div class="sidebar-tabs">
                    <div class="sidebar-tab active" onclick="switchTab('content')">
                        <i class="fas fa-edit"></i> תוכן
                    </div>
                    <div class="sidebar-tab" onclick="switchTab('design')">
                        <i class="fas fa-palette"></i> עיצוב
                    </div>
                    <div class="sidebar-tab" onclick="switchTab('services')">
                        <i class="fas fa-list"></i> שירותים
                    </div>
                </div>

                <div class="sidebar-content">
                    <!-- Content Tab -->
                    <div id="contentTab" class="tab-content">
                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-info-circle"></i>
                                מידע בסיסי
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">שם העסק</label>
                                <input type="text" class="form-input" id="businessName" onchange="updatePreview()" placeholder="שם העסק">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">תיאור העסק</label>
                                <textarea class="form-input form-textarea" id="businessDescription" onchange="updatePreview()" placeholder="תיאור קצר של העסק"></textarea>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-phone"></i>
                                פרטי יצירת קשר
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">טלפון</label>
                                <input type="text" class="form-input" id="phone" onchange="updatePreview()" placeholder="03-1234567">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">דוא"ל</label>
                                <input type="email" class="form-input" id="email" onchange="updatePreview()" placeholder="info@business.co.il">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">כתובת</label>
                                <input type="text" class="form-input" id="address" onchange="updatePreview()" placeholder="רחוב הראשי 123, תל אביב">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">WhatsApp</label>
                                <input type="text" class="form-input" id="whatsapp" onchange="updatePreview()" placeholder="972501234567">
                            </div>
                        </div>
                    </div>

                    <!-- Design Tab -->
                    <div id="designTab" class="tab-content" style="display: none;">
                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-palette"></i>
                                צבעים
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">צבע ראשי</label>
                                <div class="color-grid">
                                    <div class="color-option" style="background: #2563eb" onclick="changeColor('primary', '#2563eb')"></div>
                                    <div class="color-option" style="background: #059669" onclick="changeColor('primary', '#059669')"></div>
                                    <div class="color-option" style="background: #dc2626" onclick="changeColor('primary', '#dc2626')"></div>
                                    <div class="color-option" style="background: #f59e0b" onclick="changeColor('primary', '#f59e0b')"></div>
                                    <div class="color-option" style="background: #8b5cf6" onclick="changeColor('primary', '#8b5cf6')"></div>
                                    <div class="color-option" style="background: #ec4899" onclick="changeColor('primary', '#ec4899')"></div>
                                    <div class="color-option" style="background: #0891b2" onclick="changeColor('primary', '#0891b2')"></div>
                                    <div class="color-option" style="background: #1e40af" onclick="changeColor('primary', '#1e40af')"></div>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-font"></i>
                                טיפוגרפיה
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">פונט כותרות</label>
                                <select class="form-input" id="headingFont" onchange="updatePreview()">
                                    <option value="Playfair Display">Playfair Display</option>
                                    <option value="Poppins">Poppins</option>
                                    <option value="Montserrat">Montserrat</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">פונט טקסט</label>
                                <select class="form-input" id="bodyFont" onchange="updatePreview()">
                                    <option value="Assistant">Assistant</option>
                                    <option value="Open Sans">Open Sans</option>
                                    <option value="Roboto">Roboto</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Services Tab -->
                    <div id="servicesTab" class="tab-content" style="display: none;">
                        <div class="section">
                            <div class="section-title">
                                <i class="fas fa-list"></i>
                                ניהול שירותים
                            </div>
                            
                            <div class="services-list" id="servicesList">
                                <!-- השירותים יטענו כאן -->
                            </div>
                            
                            <button class="add-service-btn" onclick="addNewService()">
                                <i class="fas fa-plus"></i>
                                הוסף שירות חדש
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Preview -->
            <div class="center-preview">
                <div class="preview-toolbar">
                    <div class="device-controls">
                        <button class="device-btn active" onclick="setPreviewDevice('desktop')">
                            <i class="fas fa-desktop"></i>
                            מחשב
                        </button>
                        <button class="device-btn" onclick="setPreviewDevice('tablet')">
                            <i class="fas fa-tablet-alt"></i>
                            טאבלט
                        </button>
                        <button class="device-btn" onclick="setPreviewDevice('mobile')">
                            <i class="fas fa-mobile-alt"></i>
                            נייד
                        </button>
                    </div>
                    
                    <div class="preview-actions">
                        <button class="preview-btn" onclick="refreshPreview()">
                            <i class="fas fa-sync"></i> רענן
                        </button>
                        <button class="preview-btn" onclick="toggleGrid()">
                            <i class="fas fa-th"></i> רשת
                        </button>
                    </div>
                </div>
                
                <div class="preview-container">
                    <div class="preview-frame" id="previewFrame">
                        <div class="preview-content">
                            <div style="text-align: center; padding: 4rem 2rem; color: #64748b;">
                                <i class="fas fa-edit" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                                <h3>בחר אתר לעריכה</h3>
                                <p>השתמש ברשימה הנפתחת למעלה לבחירת אתר לעריכה</p>
                                <div style="margin-top: 2rem;">
                                    <button onclick="showSupabaseConfig()" style="background: var(--primary); color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer;">
                                        <i class="fas fa-database"></i> התחבר למסד נתונים
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                    <div style="text-align: center;">
                        <div class="loading-spinner"></div>
                        <p style="margin-top: 1rem; color: var(--text-medium);">טוען...</p>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="right-sidebar">
                <div class="section">
                    <div class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        סטטיסטיקות
                    </div>
                    
                    <div class="stats-section">
                        <div class="stat-item">
                            <span class="stat-label">שירותים</span>
                            <span class="stat-value" id="totalServices">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">מילים</span>
                            <span class="stat-value" id="totalWords">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">שינויים</span>
                            <span class="stat-value" id="totalChanges">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">שמירה אחרונה</span>
                            <span class="stat-value" id="lastSaved">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">מצב חיבור</span>
                            <span class="stat-value" id="connectionStatus">מנותק</span>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">
                        <i class="fas fa-tools"></i>
                        כלים מתקדמים
                    </div>
                    
                    <div class="form-group">
                        <button class="top-btn" style="width: 100%; margin-bottom: 1rem;" onclick="duplicateWebsite()">
                            <i class="fas fa-copy"></i>
                            שכפל אתר
                        </button>
                        
                        <button class="top-btn" style="width: 100%; margin-bottom: 1rem;" onclick="resetWebsite()">
                            <i class="fas fa-undo"></i>
                            איפוס
                        </button>
                        
                        <button class="top-btn" style="width: 100%; margin-bottom: 1rem;" onclick="optimizeWebsite()">
                            <i class="fas fa-rocket"></i>
                            אופטימיזציה
                        </button>
                        
                        <button class="top-btn" style="width: 100%;" onclick="syncWithSupabase()" id="syncBtn" disabled>
                            <i class="fas fa-sync"></i>
                            סנכרון DB
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase Configuration Modal -->
    <div class="modal-overlay" id="supabaseModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">הגדרת חיבור Supabase</h3>
                <button class="close-btn" onclick="hideSupabaseConfig()">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Supabase URL:</label>
                <input type="text" class="form-input" id="supabaseUrl" 
                       placeholder="https://your-project.supabase.co">
            </div>
            
            <div class="form-group">
                <label class="form-label">API Key (anon):</label>
                <input type="text" class="form-input" id="supabaseKey" 
                       placeholder="eyJ... (public anon key)">
            </div>
            
            <div class="btn-group">
                <button class="top-btn btn-secondary" onclick="hideSupabaseConfig()">
                    ביטול
                </button>
                <button class="top-btn primary" onclick="connectToSupabase()">
                    <i class="fas fa-plug"></i>
                    התחבר
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== משתנים גלובליים =====
        let currentWebsite = null;
        let websitesData = {};
        let currentChanges = 0;
        let autoSaveInterval = null;
        let supabaseClient = null;
        let isConnected = false;

        // נתוני דמו של כל 11 האתרים
        const demoWebsitesData = {
            'dr-michal-rosen': {
                id: 'dr-michal-rosen',
                name: 'ד"ר מיכל רוזן',
                category: 'רפואה אסתטית',
                businessName: 'ד"ר מיכל רוזן - רפואה אסתטית',
                businessDescription: 'מומחית ברפואה אסתטית עם ניסיון של 15 שנה. מתמחה בטיפולי בוטוקס, פילר והידוק עור',
                phone: '03-1234567',
                email: 'info@dr-michal-rosen.co.il',
                address: 'רחוב הרצל 123, תל אביב',
                whatsapp: '972501234567',
                primaryColor: '#4f46e5',
                price: '₪2,800',
                services: [
                    { id: 1, name: 'טיפולי בוטוקס', description: 'טיפול מתקדם להחלקת קמטים', price: '₪800', icon: 'fas fa-syringe' },
                    { id: 2, name: 'הזרקות פילר', description: 'מילוי נפח לשפתיים ולחיים', price: '₪1,200', icon: 'fas fa-tint' },
                    { id: 3, name: 'הידוק עור HIFU', description: 'טכנולוגיה מתקדמת לחידוש העור', price: '₪2,500', icon: 'fas fa-magic' },
                    { id: 4, name: 'טיפול PRP', description: 'חידוש העור בעזרת פלזמה עשירה', price: '₪1,500', icon: 'fas fa-heart' },
                    { id: 5, name: 'הסרת נימים', description: 'הסרה בטוחה של נימים בפנים', price: '₪600', icon: 'fas fa-eye' },
                    { id: 6, name: 'ייעוץ וטיפוח', description: 'ייעוץ מקצועי אישי', price: '₪300', icon: 'fas fa-user-md' }
                ]
            },
            'fitness-coach': {
                id: 'fitness-coach',
                name: 'דני פיט - מאמן כושר',
                category: 'כושר ובריאות',
                businessName: 'דני פיט - מאמן כושר אישי',
                businessDescription: 'מאמן כושר מוסמך עם התמחות באימונים אישיים ותוכניות תזונה מותאמות אישית',
                phone: '052-9876543',
                email: 'danny@dannyfit.co.il',
                address: 'רחוב הספורט 45, רמת גן',
                whatsapp: '972529876543',
                primaryColor: '#ef4444',
                price: '₪2,200',
                services: [
                    { id: 1, name: 'אימון אישי', description: 'אימון אישי מותאם למטרות שלך', price: '₪200', icon: 'fas fa-dumbbell' },
                    { id: 2, name: 'תוכנית תזונה', description: 'תוכנית תזונה מותאמת אישית', price: '₪400', icon: 'fas fa-apple-alt' },
                    { id: 3, name: 'אימון קבוצתי', description: 'אימון בקבוצה קטנה ומגובשת', price: '₪120', icon: 'fas fa-users' },
                    { id: 4, name: 'אימון בבית', description: 'אימון אישי בבית הלקוח', price: '₪250', icon: 'fas fa-home' },
                    { id: 5, name: 'שיקום ופציעות', description: 'אימון מותאם לשיקום פציעות', price: '₪300', icon: 'fas fa-heartbeat' },
                    { id: 6, name: 'הכנה לתחרויות', description: 'הכנה מקצועית לתחרויות כושר', price: '₪500', icon: 'fas fa-trophy' }
                ]
            },
            'yoga-studio': {
                id: 'yoga-studio',
                name: 'סטודיו אוהם יוגה',
                category: 'יוגה ומדיטציה',
                businessName: 'סטודיו אוהם - יוגה ומדיטציה',
                businessDescription: 'סטודיו יוגה מקצועי המציע שיעורי יוגה, מדיטציה וטיפול הוליסטי בסביבה רגועה',
                phone: '03-7654321',
                email: 'info@ohm-yoga.co.il',
                address: 'רחוב השקט 18, תל אביב',
                whatsapp: '972507654321',
                primaryColor: '#22c55e',
                price: '₪1,900',
                services: [
                    { id: 1, name: 'יוגה למתחילים', description: 'שיעורים מיוחדים למתחילים', price: '₪80', icon: 'fas fa-seedling' },
                    { id: 2, name: 'יוגה מתקדמת', description: 'שיעורים לתרגול מתקדם', price: '₪100', icon: 'fas fa-leaf' },
                    { id: 3, name: 'מדיטציה מודרכת', description: 'שיעורי מדיטציה למתחילים ומתקדמים', price: '₪60', icon: 'fas fa-om' },
                    { id: 4, name: 'יוגה טיפולית', description: 'יוגה מותאמת לבעיות גוף', price: '₪150', icon: 'fas fa-hands-helping' },
                    { id: 5, name: 'פרנאיאמה', description: 'תרגולי נשימה מתקדמים', price: '₪70', icon: 'fas fa-wind' },
                    { id: 6, name: 'סדנאות מיוחדות', description: 'סדנאות בנושאים שונים', price: '₪200', icon: 'fas fa-star' }
                ]
            },
            'nutritionist': {
                id: 'nutritionist',
                name: 'ד"ר שרה כהן - תזונאית',
                category: 'תזונה קלינית',
                businessName: 'ד"ר שרה כהן - תזונה קלינית',
                businessDescription: 'תזונאית קלינית מוסמכת עם התמחות בהרזיה, סוכרת, ותזונה ספורטיבית',
                phone: '054-1111222',
                email: 'sarah@nutrition.co.il',
                address: 'רחוב הבריאות 67, חיפה',
                whatsapp: '972541111222',
                primaryColor: '#10b981',
                price: '₪2,400',
                services: [
                    { id: 1, name: 'ייעוץ תזונתי', description: 'ייעוץ אישי מותאם למטרות', price: '₪300', icon: 'fas fa-user-md' },
                    { id: 2, name: 'תפריט אישי', description: 'תפריט מותאם אישית למטרות', price: '₪500', icon: 'fas fa-list-alt' },
                    { id: 3, name: 'מעקב תזונתי', description: 'מעקב והתאמות שוטפות', price: '₪200', icon: 'fas fa-chart-line' },
                    { id: 4, name: 'תזונה ספורטיבית', description: 'ייעוץ תזונתי לספורטאים', price: '₪400', icon: 'fas fa-running' },
                    { id: 5, name: 'טיפול סוכרת', description: 'ייעוץ תזונתי למטופלי סוכרת', price: '₪350', icon: 'fas fa-heartbeat' },
                    { id: 6, name: 'סדנאות תזונה', description: 'סדנאות חינוכיות בתזונה', price: '₪150', icon: 'fas fa-chalkboard-teacher' }
                ]
            },
            'law-firm': {
                id: 'law-firm',
                name: 'משרד ברקוביץ ושות\'',
                category: 'שירותים משפטיים',
                businessName: 'משרד עורכי דין ברקוביץ ושות\'',
                businessDescription: 'משרד עורכי דין מוביל עם התמחות בדיני משפחה, עבודה ונזיקין. ניסיון של 20 שנה',
                phone: '03-5556666',
                email: 'office@barkowitz-law.co.il',
                address: 'רחוב הצדק 89, תל אביב',
                whatsapp: '972505556666',
                primaryColor: '#1e40af',
                price: '₪2,500',
                services: [
                    { id: 1, name: 'דיני משפחה', description: 'גירושין, מזונות, חלוקת רכוש ומשמורת', price: '₪1,500', icon: 'fas fa-home' },
                    { id: 2, name: 'דיני עבודה', description: 'פיטורים, הטרדות ופיצויים', price: '₪1,200', icon: 'fas fa-briefcase' },
                    { id: 3, name: 'דיני נזיקין', description: 'תאונות דרכים ורשלנות רפואית', price: '₪2,000', icon: 'fas fa-car-crash' },
                    { id: 4, name: 'דיני חוזים', description: 'ניסוח ובדיקת חוזים', price: '₪800', icon: 'fas fa-file-contract' },
                    { id: 5, name: 'ייצוג פלילי', description: 'ייצוג בהליכים פליליים', price: '₪2,500', icon: 'fas fa-gavel' },
                    { id: 6, name: 'ייעוץ משפטי', description: 'ייעוץ ראשוני ותכנון', price: '₪500', icon: 'fas fa-comments' }
                ]
            },
            'accountant': {
                id: 'accountant',
                name: 'רינה לוי - חשבת שכר',
                category: 'חשבונאות ושכר',
                businessName: 'רינה לוי - שירותי חשבות שכר',
                businessDescription: 'חשבת שכר מוסמכת עם התמחות בחברות הייטק וניהול משכורות מורכבות',
                phone: '08-9998887',
                email: 'rina@payroll.co.il',
                address: 'רחוב העסקים 234, באר שבע',
                whatsapp: '972509998887',
                primaryColor: '#7c3aed',
                price: '₪2,000',
                services: [
                    { id: 1, name: 'חישוב שכר חודשי', description: 'חישוב מדויק של משכורת חודשית', price: '₪150', icon: 'fas fa-calculator' },
                    { id: 2, name: 'דוחות שכר', description: 'הכנת דוחות שכר מפורטים', price: '₪200', icon: 'fas fa-file-alt' },
                    { id: 3, name: 'ניהול ביטוח לאומי', description: 'טיפול בכל הקשור לביטוח לאומי', price: '₪100', icon: 'fas fa-shield-alt' },
                    { id: 4, name: 'ייעוץ פנסיוני', description: 'ייעוץ בבחירת מסלול פנסיוני', price: '₪300', icon: 'fas fa-piggy-bank' },
                    { id: 5, name: 'אופציות עובדים', description: 'ניהול אופציות בחברות הייטק', price: '₪400', icon: 'fas fa-chart-line' },
                    { id: 6, name: 'הצהרות מס', description: 'הכנה והגשת הצהרות מס', price: '₪250', icon: 'fas fa-receipt' }
                ]
            },
            'beauty-salon': {
                id: 'beauty-salon',
                name: 'מספרה BELLA',
                category: 'יופי ועיצוב',
                businessName: 'מספרה BELLA - יופי ועיצוב',
                businessDescription: 'מספרה מקצועית המציעה שירותי עיצוב שיער, צביעה וטיפוח בסטייל המתקדם ביותר',
                phone: '02-4445555',
                email: 'bella@beauty.co.il',
                address: 'רחוב היופי 12, ירושלים',
                whatsapp: '972504445555',
                primaryColor: '#ec4899',
                price: '₪1,700',
                services: [
                    { id: 1, name: 'תספורת נשים', description: 'תספורת מקצועית לפי הטרנדים', price: '₪150', icon: 'fas fa-cut' },
                    { id: 2, name: 'צביעת שיער', description: 'צביעה מקצועית בטכניקות מתקדמות', price: '₪300', icon: 'fas fa-palette' },
                    { id: 3, name: 'עיצוב גבות', description: 'עיצוב גבות מדויק ומקצועי', price: '₪80', icon: 'fas fa-eye' },
                    { id: 4, name: 'טיפוח פנים', description: 'טיפול פנים מפנק ומחדש', price: '₪200', icon: 'fas fa-spa' },
                    { id: 5, name: 'מניקור', description: 'מניקור מקצועי עם לכות איכותיות', price: '₪100', icon: 'fas fa-hand-paper' },
                    { id: 6, name: 'פדיקור', description: 'פדיקור מפנק ומרגיע', price: '₪120', icon: 'fas fa-shoe-prints' }
                ]
            },
            'private-teacher': {
                id: 'private-teacher',
                name: 'ד"ר רונית לוי - מורה פרטית',
                category: 'חינוך והוראה',
                businessName: 'ד"ר רונית לוי - הוראה פרטית',
                businessDescription: 'מורה פרטית מנוסה לבגרויות במתמטיקה, פיזיקה ואנגלית. הכנה מקצועית לבחינות',
                phone: '09-7778888',
                email: 'ronit@teaching.co.il',
                address: 'רחוב החינוך 56, פתח תקווה',
                whatsapp: '972507778888',
                primaryColor: '#059669',
                price: '₪2,100',
                services: [
                    { id: 1, name: 'מתמטיקה 5 יח"ל', description: 'הכנה מקצועית לבגרות במתמטיקה', price: '₪180', icon: 'fas fa-square-root-alt' },
                    { id: 2, name: 'פיזיקה 5 יח"ל', description: 'הכנה מקצועית לבגרות בפיזיקה', price: '₪180', icon: 'fas fa-atom' },
                    { id: 3, name: 'אנגלית 5 יח"ל', description: 'הכנה לבגרות באנגלית רמה גבוהה', price: '₪150', icon: 'fas fa-language' },
                    { id: 4, name: 'הכנה לפסיכומטרי', description: 'הכנה מקיפה למבחן הפסיכומטרי', price: '₪200', icon: 'fas fa-brain' },
                    { id: 5, name: 'שיעורים קבוצתיים', description: 'שיעורים בקבוצות קטנות', price: '₪120', icon: 'fas fa-users' },
                    { id: 6, name: 'מכינה לתיכון', description: 'הכנה לקראת התיכון', price: '₪140', icon: 'fas fa-school' }
                ]
            },
            'aesthetic-clinic': {
                id: 'aesthetic-clinic',
                name: 'קליניקת יופי פרמיום',
                category: 'אסתטיקה רפואית',
                businessName: 'קליניקת יופי פרמיום',
                businessDescription: 'קליניקת יופי מתקדמת עם הטכנולוגיות החדישות בעולם האסתטיקה הרפואית',
                phone: '03-9999888',
                email: 'info@premium-beauty.co.il',
                address: 'רחוב הדר 99, תל אביב',
                whatsapp: '972509999888',
                primaryColor: '#4f46e5',
                price: '₪3,200',
                services: [
                    { id: 1, name: 'בוטוקס פרמיום', description: 'בוטוקס מהמותגים המובילים בעולם', price: '₪1,200', icon: 'fas fa-syringe' },
                    { id: 2, name: 'פילר יוקרתי', description: 'פילר מחומרים איכותיים ביותר', price: '₪1,800', icon: 'fas fa-tint' },
                    { id: 3, name: 'הידוק HIFU', description: 'טכנולוגיית הידוק מתקדמת', price: '₪3,500', icon: 'fas fa-magic' },
                    { id: 4, name: 'לייזר הסרת שיער', description: 'הסרת שיער קבועה בלייזר', price: '₪800', icon: 'fas fa-burn' },
                    { id: 5, name: 'מיקרו-ניידלינג', description: 'חידוש העור בטכניקה מתקדמת', price: '₪1,000', icon: 'fas fa-eye-dropper' },
                    { id: 6, name: 'טיפולי RF', description: 'טיפולי רדיו-פריקוונסיה', price: '₪2,200', icon: 'fas fa-waves-sine' }
                ]
            },
            'multibrawn': {
                id: 'multibrawn',
                name: 'מולטיבראון נופש',
                category: 'נופש ואירועים',
                businessName: 'מולטיבראון - חברת נופש',
                businessDescription: 'חברת נופש מובילה המתמחה בארגון חופשות מותאמות אישית ואירועים מיוחדים',
                phone: '04-6667777',
                email: 'info@multibrawn.co.il',
                address: 'רחוב הנופש 77, חיפה',
                whatsapp: '972546667777',
                primaryColor: '#ea580c',
                price: '₪2,300',
                services: [
                    { id: 1, name: 'נופש משפחתי', description: 'חבילות נופש מותאמות למשפחות', price: '₪2,500', icon: 'fas fa-home' },
                    { id: 2, name: 'אירועים עסקיים', description: 'ארגון אירועי חברה וכנסים', price: '₪5,000', icon: 'fas fa-briefcase' },
                    { id: 3, name: 'חופשות זוגיות', description: 'חבילות רומנטיות לזוגות', price: '₪3,000', icon: 'fas fa-heart' },
                    { id: 4, name: 'טיולים מאורגנים', description: 'טיולים מאורגנים בארץ ובחו"ל', price: '₪1,800', icon: 'fas fa-bus' },
                    { id: 5, name: 'וילות נופש', description: 'השכרת וילות יוקרתיות', price: '₪4,000', icon: 'fas fa-building' },
                    { id: 6, name: 'שירותי קונסיירז׳', description: 'שירותים אישיים מותאמים', price: '₪1,000', icon: 'fas fa-concierge-bell' }
                ]
            },
            'real-estate': {
                id: 'real-estate',
                name: 'נדל"ן פרמיום',
                category: 'נדל"ן',
                businessName: 'נדל"ן פרמיום - תיווך יוקרתי',
                businessDescription: 'חברת תיווך נדל"ן יוקרתית המתמחה בנכסים איכותיים ושירות מקצועי ברמה הגבוהה ביותר',
                phone: '03-1112223',
                email: 'info@premium-real-estate.co.il',
                address: 'רחוב הנדל"ן 123, תל אביב',
                whatsapp: '972501112223',
                primaryColor: '#65a30d',
                price: '₪2,700',
                services: [
                    { id: 1, name: 'מכירת דירות יוקרה', description: 'מכירת נכסי יוקרה ברמה הגבוהה ביותר', price: '₪15,000', icon: 'fas fa-home' },
                    { id: 2, name: 'השכרת פנטהאוזים', description: 'השכרת פנטהאוזים יוקרתיים', price: '₪8,000', icon: 'fas fa-building' },
                    { id: 3, name: 'השקעות נדל"ן', description: 'ייעוץ והכוונה בהשקעות נדל"ן', price: '₪5,000', icon: 'fas fa-chart-line' },
                    { id: 4, name: 'הערכות שווי', description: 'הערכות שווי מקצועיות ומדויקות', price: '₪2,000', icon: 'fas fa-calculator' },
                    { id: 5, name: 'ניהול נכסים', description: 'ניהול נכסים עבור בעלי נכסים', price: '₪3,000', icon: 'fas fa-key' },
                    { id: 6, name: 'שירות VIP', description: 'שירות אישי ומותאם VIP', price: '₪10,000', icon: 'fas fa-crown' }
                ]
            }
        };

        // ===== אתחול =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎨 WebMaster Pro Editor - Loading...');
            
            // טעינת נתוני דמו
            websitesData = { ...demoWebsitesData };
            
            // טעינת רשימת האתרים
            populateWebsiteSelector();
            
            // הפעלת שמירה אוטומטית
            enableAutoSave();
            
            // ניסיון טעינת הגדרות Supabase שמורות
            loadSupabaseSettings();
            
            console.log('✅ WebMaster Pro Editor - Ready!');
        });

        // ===== Supabase Functions =====
        function showSupabaseConfig() {
            document.getElementById('supabaseModal').style.display = 'flex';
        }

        function hideSupabaseConfig() {
            document.getElementById('supabaseModal').style.display = 'none';
        }

        function loadSupabaseSettings() {
            const savedUrl = localStorage.getItem('supabase_url');
            const savedKey = localStorage.getItem('supabase_key');
            
            if (savedUrl && savedKey) {
                document.getElementById('supabaseUrl').value = savedUrl;
                document.getElementById('supabaseKey').value = savedKey;
                connectToSupabase();
            }
        }

        async function connectToSupabase() {
            const url = document.getElementById('supabaseUrl').value.trim();
            const key = document.getElementById('supabaseKey').value.trim();

            if (!url || !key) {
                showMessage('נא להכניס URL ו-API Key', 'error');
                return;
            }

            showLoading(true);

            try {
                // יצירת לקוח Supabase פשוט
                supabaseClient = {
                    url: url,
                    key: key,
                    
                    async select(table, filter = '') {
                        const response = await fetch(`${this.url}/rest/v1/${table}${filter}`, {
                            headers: {
                                'apikey': this.key,
                                'Authorization': `Bearer ${this.key}`
                            }
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        return await response.json();
                    },
                    
                    async update(table, id, data) {
                        const response = await fetch(`${this.url}/rest/v1/${table}?id=eq.${id}`, {
                            method: 'PATCH',
                            headers: {
                                'apikey': this.key,
                                'Authorization': `Bearer ${this.key}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        });
                        
                        return response.ok;
                    },

                    async insert(table, data) {
                        const response = await fetch(`${this.url}/rest/v1/${table}`, {
                            method: 'POST',
                            headers: {
                                'apikey': this.key,
                                'Authorization': `Bearer ${this.key}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        });
                        
                        return response.ok;
                    }
                };
                
                // בדיקת חיבור
                await supabaseClient.select('websites');
                
                // שמירת הגדרות
                localStorage.setItem('supabase_url', url);
                localStorage.setItem('supabase_key', key);
                
                // עדכון UI
                updateConnectionStatus(true);
                enableButtons();
                hideSupabaseConfig();
                
                showMessage('חיבור למסד הנתונים הצליח!', 'success');
                
                // טעינת נתונים ממסד הנתונים
                await loadWebsitesFromSupabase();
                
            } catch (error) {
                console.error('Connection error:', error);
                updateConnectionStatus(false);
                showMessage(`שגיאת חיבור: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function loadWebsitesFromSupabase() {
            if (!supabaseClient) return;

            try {
                const websites = await supabaseClient.select('websites');
                
                if (websites.length > 0) {
                    // המרה לפורמט מקומי
                    websites.forEach(website => {
                        if (websitesData[website.id]) {
                            // עדכון נתונים קיימים עם נתונים ממסד הנתונים
                            websitesData[website.id] = {
                                ...websitesData[website.id],
                                businessName: website.name,
                                businessDescription: website.description,
                                phone: website.custom_data?.phone || websitesData[website.id].phone,
                                email: website.custom_data?.email || websitesData[website.id].email,
                                address: website.custom_data?.address || websitesData[website.id].address,
                                whatsapp: website.custom_data?.whatsapp || websitesData[website.id].whatsapp,
                                primaryColor: website.template?.colors?.primary || websitesData[website.id].primaryColor
                            };
                        }
                    });
                    
                    populateWebsiteSelector();
                    showMessage(`נטענו ${websites.length} אתרים ממסד הנתונים`, 'success');
                }
                
            } catch (error) {
                console.error('Error loading from Supabase:', error);
                showMessage('שגיאה בטעינת נתונים ממסד הנתונים', 'warning');
            }
        }

        function updateConnectionStatus(connected) {
            isConnected = connected;
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const connectionStatus = document.getElementById('connectionStatus');
            
            if (connected) {
                statusDot.classList.add('connected');
                statusText.textContent = 'מחובר';
                connectionStatus.textContent = 'מחובר';
            } else {
                statusDot.classList.remove('connected');
                statusText.textContent = 'לא מחובר';
                connectionStatus.textContent = 'מנותק';
            }
        }

        function enableButtons() {
            const buttons = ['saveWebsite', 'previewWebsite', 'exportWebsite'];
            buttons.forEach(btnId => {
                const btn = document.querySelector(`[onclick="${btnId}()"]`);
                if (btn) btn.disabled = false;
            });
            
            document.getElementById('syncBtn').disabled = false;
        }

        // ===== Website Management =====
        function populateWebsiteSelector() {
            const selector = document.getElementById('websiteSelector');
            selector.innerHTML = '<option value="">בחר אתר לעריכה...</option>';
            
            Object.values(websitesData).forEach(website => {
                const option = document.createElement('option');
                option.value = website.id;
                option.textContent = website.name;
                selector.appendChild(option);
            });
        }

        function loadWebsiteForEditing(websiteId) {
            if (!websiteId || !websitesData[websiteId]) {
                console.warn('Website not found:', websiteId);
                return;
            }
            
            showLoading(true);
            
            setTimeout(() => {
                currentWebsite = { ...websitesData[websiteId] };
                
                // עדכון אינדיקטור
                document.getElementById('editingIndicator').style.display = 'flex';
                document.getElementById('currentWebsiteName').textContent = currentWebsite.name;
                
                // טעינת נתונים לשדות
                loadWebsiteData();
                
                // עדכון תצוגה מקדימה
                updatePreview();
                
                // עדכון סטטיסטיקות
                updateStats();
                
                showLoading(false);
                showMessage(`נטען: ${currentWebsite.name}`, 'success');
                
                console.log('📝 Website loaded for editing:', websiteId);
            }, 500);
        }

        function loadWebsiteData() {
            if (!currentWebsite) return;
            
            document.getElementById('businessName').value = currentWebsite.businessName || '';
            document.getElementById('businessDescription').value = currentWebsite.businessDescription || '';
            document.getElementById('phone').value = currentWebsite.phone || '';
            document.getElementById('email').value = currentWebsite.email || '';
            document.getElementById('address').value = currentWebsite.address || '';
            document.getElementById('whatsapp').value = currentWebsite.whatsapp || '';
            
            // טעינת שירותים
            loadServices();
            
            // עדכון צבעים
            updateColorPicker();
        }

        function updateColorPicker() {
            if (!currentWebsite) return;
            
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('active');
                if (option.style.background === currentWebsite.primaryColor) {
                    option.classList.add('active');
                }
            });
        }

        function loadServices() {
            if (!currentWebsite || !currentWebsite.services) return;
            
            const servicesList = document.getElementById('servicesList');
            servicesList.innerHTML = '';
            
            currentWebsite.services.forEach((service, index) => {
                const serviceElement = createServiceElement(service, index);
                servicesList.appendChild(serviceElement);
            });
        }

        function createServiceElement(service, index) {
            const div = document.createElement('div');
            div.className = 'service-item';
            div.innerHTML = `
                <div class="service-header">
                    <div class="service-name">${service.name}</div>
                    <div class="service-actions">
                        <button class="icon-btn edit" onclick="editService(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="icon-btn delete" onclick="deleteService(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <p style="font-size: 0.85rem; color: var(--text-medium); margin: 0.5rem 0;">${service.description}</p>
                <div class="service-price">${service.price}</div>
            `;
            return div;
        }

        // ===== Tab Management =====
        function switchTab(tabName) {
            // עדכון טאבים
            document.querySelectorAll('.sidebar-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // הסתרת כל התוכן
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // הצגת התוכן הנבחר
            document.getElementById(tabName + 'Tab').style.display = 'block';
        }

        // ===== Color Management =====
        function changeColor(type, color) {
            if (!currentWebsite) return;
            
            currentWebsite.primaryColor = color;
            
            // עדכון בורר צבעים
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updatePreview();
            markChanged();
            showMessage('צבע עודכן', 'success');
        }

        // ===== Preview Management =====
        function updatePreview() {
            if (!currentWebsite) return;
            
            // עדכון נתונים מהשדות
            currentWebsite.businessName = document.getElementById('businessName').value;
            currentWebsite.businessDescription = document.getElementById('businessDescription').value;
            currentWebsite.phone = document.getElementById('phone').value;
            currentWebsite.email = document.getElementById('email').value;
            currentWebsite.address = document.getElementById('address').value;
            currentWebsite.whatsapp = document.getElementById('whatsapp').value;
            
            const previewFrame = document.getElementById('previewFrame');
            previewFrame.innerHTML = generateWebsitePreview(currentWebsite);
            
            markChanged();
        }

        function generateWebsitePreview(website) {
            return `
                <div style="background: white; border-radius: 0; overflow: hidden; min-height: 600px;">
                    <!-- Header -->
                    <div style="background: linear-gradient(135deg, ${website.primaryColor} 0%, #059669 100%); color: white; padding: 3rem 2rem; text-align: center;">
                        <h1 style="font-size: 2.5rem; margin-bottom: 1rem; font-weight: 800; font-family: 'Playfair Display', serif;">
                            ${website.businessName || 'שם העסק'}
                        </h1>
                        <p style="font-size: 1.2rem; opacity: 0.9; max-width: 600px; margin: 0 auto 2rem;">
                            ${website.businessDescription || 'תיאור העסק'}
                        </p>
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                            <button style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 1rem 2rem; border-radius: 50px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px);">
                                <i class="fab fa-whatsapp"></i> צור קשר עכשיו
                            </button>
                            <button style="background: transparent; color: white; border: 2px solid white; padding: 1rem 2rem; border-radius: 50px; font-weight: 600; cursor: pointer;">
                                <i class="fas fa-info-circle"></i> למידע נוסף
                            </button>
                        </div>
                    </div>
                    
                    <!-- שירותים -->
                    <div style="padding: 3rem 2rem; background: white;">
                        <h2 style="text-align: center; font-size: 2rem; margin-bottom: 3rem; color: var(--text-dark); font-family: 'Playfair Display', serif;">
                            השירותים שלנו
                        </h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; max-width: 1000px; margin: 0 auto;">
                            ${(website.services || []).slice(0, 6).map(service => `
                                <div style="background: #f8fafc; padding: 2rem; border-radius: 16px; text-align: center; border: 1px solid #e2e8f0; transition: all 0.3s ease;">
                                    <div style="width: 60px; height: 60px; background: ${website.primaryColor}; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: white; font-size: 1.5rem;">
                                        <i class="${service.icon}"></i>
                                    </div>
                                    <h3 style="font-size: 1.3rem; margin-bottom: 1rem; color: var(--text-dark); font-weight: 700;">
                                        ${service.name}
                                    </h3>
                                    <p style="color: var(--text-medium); margin-bottom: 1rem; line-height: 1.6; font-size: 0.95rem;">
                                        ${service.description}
                                    </p>
                                    <div style="font-size: 1.2rem; font-weight: 700; color: #059669; margin-bottom: 1rem;">
                                        ${service.price}
                                    </div>
                                    <button style="background: ${website.primaryColor}; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 25px; font-weight: 600; cursor: pointer; font-size: 0.9rem;">
                                        הזמן עכשיו
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- יצירת קשר -->
                    <div style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); padding: 3rem 2rem; text-align: center;">
                        <h2 style="font-size: 2rem; margin-bottom: 2rem; color: var(--text-dark); font-family: 'Playfair Display', serif;">
                            יצירת קשר
                        </h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; margin-bottom: 2rem; max-width: 800px; margin-left: auto; margin-right: auto;">
                            <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                                <i class="fas fa-phone" style="font-size: 1.5rem; color: ${website.primaryColor}; margin-bottom: 0.5rem;"></i>
                                <div style="font-size: 1rem; font-weight: 600;">${website.phone || '03-1234567'}</div>
                            </div>
                            <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                                <i class="fas fa-envelope" style="font-size: 1.5rem; color: ${website.primaryColor}; margin-bottom: 0.5rem;"></i>
                                <div style="font-size: 1rem; font-weight: 600;">${website.email || 'info@business.co.il'}</div>
                            </div>
                            <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                                <i class="fas fa-map-marker-alt" style="font-size: 1.5rem; color: ${website.primaryColor}; margin-bottom: 0.5rem;"></i>
                                <div style="font-size: 1rem; font-weight: 600;">${website.address || 'כתובת העסק'}</div>
                            </div>
                        </div>
                        <button style="background: #25d366; color: white; border: none; padding: 1rem 2rem; border-radius: 50px; font-size: 1.1rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);">
                            <i class="fab fa-whatsapp" style="margin-left: 0.5rem; font-size: 1.2rem;"></i>
                            שלח הודעה בוואטסאפ
                        </button>
                    </div>
                </div>
            `;
        }

        function setPreviewDevice(device) {
            const previewFrame = document.getElementById('previewFrame');
            const deviceBtns = document.querySelectorAll('.device-btn');
            
            // עדכון כפתורים
            deviceBtns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // החלפת גודל
            previewFrame.className = `preview-frame ${device}`;
        }

        function refreshPreview() {
            updatePreview();
            showMessage('תצוגה מקדימה עודכנה', 'success');
        }

        function toggleGrid() {
            showMessage('תכונה בפיתוח...', 'warning');
        }

        // ===== Service Management =====
        function addNewService() {
            if (!currentWebsite) return;
            
            const name = prompt('שם השירות החדש:', 'שירות חדש');
            if (!name) return;
            
            const description = prompt('תיאור השירות:', 'תיאור השירות החדש');
            if (!description) return;
            
            const price = prompt('מחיר השירות:', '₪0');
            if (!price) return;
            
            if (!currentWebsite.services) {
                currentWebsite.services = [];
            }
            
            currentWebsite.services.push({
                id: Date.now(),
                name: name,
                description: description,
                price: price,
                icon: 'fas fa-star'
            });
            
            loadServices();
            updatePreview();
            updateStats();
            markChanged();
            showMessage('שירות חדש נוסף', 'success');
        }

        function editService(index) {
            if (!currentWebsite || !currentWebsite.services || !currentWebsite.services[index]) return;
            
            const service = currentWebsite.services[index];
            
            const name = prompt('שם השירות:', service.name);
            if (name === null) return;
            
            const description = prompt('תיאור השירות:', service.description);
            if (description === null) return;
            
            const price = prompt('מחיר השירות:', service.price);
            if (price === null) return;
            
            currentWebsite.services[index] = {
                ...service,
                name: name,
                description: description,
                price: price
            };
            
            loadServices();
            updatePreview();
            updateStats();
            markChanged();
            showMessage('שירות עודכן', 'success');
        }

        function deleteService(index) {
            if (!currentWebsite || !currentWebsite.services || !currentWebsite.services[index]) return;
            
            if (confirm('האם אתה בטוח שברצונך למחוק את השירות?')) {
                currentWebsite.services.splice(index, 1);
                loadServices();
                updatePreview();
                updateStats();
                markChanged();
                showMessage('שירות נמחק', 'success');
            }
        }

        // ===== Save Functions =====
        async function saveWebsite() {
            if (!currentWebsite) {
                showMessage('לא נבחר אתר לשמירה', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                // שמירה מקומית
                localStorage.setItem(`website_${currentWebsite.id}`, JSON.stringify(currentWebsite));
                websitesData[currentWebsite.id] = { ...currentWebsite };
                
                // שמירה ב-Supabase אם מחובר
                if (supabaseClient && isConnected) {
                    const success = await supabaseClient.update('websites', currentWebsite.id, {
                        name: currentWebsite.businessName,
                        description: currentWebsite.businessDescription,
                        custom_data: {
                            phone: currentWebsite.phone,
                            email: currentWebsite.email,
                            address: currentWebsite.address,
                            whatsapp: currentWebsite.whatsapp
                        },
                        template: {
                            colors: {
                                primary: currentWebsite.primaryColor
                            }
                        }
                    });
                    
                    if (success) {
                        console.log('💾 Website saved to database');
                    }
                }
                
                // איפוס מונה שינויים
                currentChanges = 0;
                updateStats();
                
                showMessage('השינויים נשמרו בהצלחה!', 'success');
                
            } catch (error) {
                console.error('Save error:', error);
                showMessage('שגיאה בשמירת השינויים', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function syncWithSupabase() {
            if (!supabaseClient || !isConnected || !currentWebsite) {
                showMessage('לא מחובר למסד נתונים או לא נבחר אתר', 'error');
                return;
            }

            showLoading(true);

            try {
                // סנכרון דו-כיווני עם Supabase
                await saveWebsite();
                await loadWebsitesFromSupabase();
                
                showMessage('סנכרון עם מסד הנתונים הושלם', 'success');
                
            } catch (error) {
                console.error('Sync error:', error);
                showMessage('שגיאה בסנכרון עם מסד הנתונים', 'error');
            } finally {
                showLoading(false);
            }
        }

        // ===== Other Functions =====
        function previewWebsite() {
            if (!currentWebsite) return;
            
            const previewWindow = window.open('', '_blank');
            previewWindow.document.write(generateFullWebsiteHTML(currentWebsite));
            previewWindow.document.close();
            
            showMessage('פותח תצוגה מקדימה...', 'success');
        }

        function generateFullWebsiteHTML(website) {
            return `
                <!DOCTYPE html>
                <html lang="he" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${website.businessName}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700;800&display=swap" rel="stylesheet">
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
                    <style>
                        body { margin: 0; font-family: 'Assistant', sans-serif; }
                        .hero { background: linear-gradient(135deg, ${website.primaryColor} 0%, #059669 100%); color: white; padding: 4rem 2rem; text-align: center; }
                        .hero h1 { font-family: 'Playfair Display', serif; font-size: 3rem; margin-bottom: 1rem; }
                        .hero p { font-size: 1.3rem; margin-bottom: 2rem; opacity: 0.9; }
                        .services { padding: 4rem 2rem; }
                        .services h2 { text-align: center; font-size: 2.5rem; margin-bottom: 3rem; }
                        .services-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; max-width: 1200px; margin: 0 auto; }
                        .service-card { background: #f8fafc; padding: 2rem; border-radius: 16px; text-align: center; }
                        .contact { background: #f8fafc; padding: 4rem 2rem; text-align: center; }
                        .btn { background: ${website.primaryColor}; color: white; border: none; padding: 1rem 2rem; border
