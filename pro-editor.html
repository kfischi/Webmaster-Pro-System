<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebMaster Pro - ××“×™×˜×•×¨ ×•×™×–×•××œ×™ ××ª×§×“×</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Assistant', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
        }

        .editor-container {
            display: flex;
            height: 100vh;
            background: white;
        }

        /* Header */
        .editor-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .website-selector {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            padding: 8px 15px;
            color: white;
            min-width: 200px;
            backdrop-filter: blur(10px);
        }

        .website-selector option {
            background: #333;
            color: white;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .header-btn.primary {
            background: #ff6b6b;
            border-color: #ff5252;
        }

        .header-btn.primary:hover {
            background: #ff5252;
        }

        /* Sidebar Left */
        .sidebar-left {
            width: 280px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
            margin-top: 60px;
            overflow-y: auto;
            max-height: calc(100vh - 60px);
        }

        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tool-btn {
            background: white;
            border: 1px solid #dee2e6;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
            color: #495057;
        }

        .tool-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tool-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .color-picker {
            width: 100%;
            height: 40px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
        }

        .slider-control {
            margin: 10px 0;
        }

        .slider-control label {
            display: block;
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .slider-control input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #dee2e6;
            outline: none;
        }

        /* Main Editor Area */
        .editor-main {
            flex: 1;
            margin-top: 60px;
            background: #f1f3f4;
            display: flex;
            flex-direction: column;
        }

        .editor-toolbar {
            height: 50px;
            background: white;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .view-controls {
            display: flex;
            gap: 10px;
        }

        .view-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .view-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .device-controls {
            display: flex;
            gap: 5px;
        }

        .device-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
        }

        .device-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .editor-viewport {
            flex: 1;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow: auto;
        }

        .website-frame {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .website-frame.desktop {
            width: 1200px;
            height: 800px;
        }

        .website-frame.tablet {
            width: 768px;
            height: 1024px;
        }

        .website-frame.mobile {
            width: 375px;
            height: 667px;
        }

        .website-content {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 12px;
        }

        /* Sidebar Right */
        .sidebar-right {
            width: 300px;
            background: #f8f9fa;
            border-left: 1px solid #e9ecef;
            margin-top: 60px;
            overflow-y: auto;
            max-height: calc(100vh - 60px);
        }

        .properties-section {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .property-group {
            margin-bottom: 20px;
        }

        .property-label {
            display: block;
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .property-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .property-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Status Bar */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: #343a40;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 0.9rem;
            z-index: 1000;
        }

        .status-left {
            display: flex;
            gap: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
        }

        .status-indicator.saving {
            background: #ffc107;
            animation: pulse 1s infinite;
        }

        .status-indicator.error {
            background: #dc3545;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #343a40;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #495057;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .modal-btn.primary {
            background: #667eea;
            color: white;
        }

        .modal-btn.primary:hover {
            background: #5a6fd8;
        }

        .modal-btn.secondary {
            background: #6c757d;
            color: white;
        }

        .modal-btn.secondary:hover {
            background: #5a6268;
        }

        /* Alert/Message System */
        .alert {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 4000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .alert.show {
            opacity: 1;
            transform: translateX(0);
        }

        .alert.success {
            background: #28a745;
        }

        .alert.error {
            background: #dc3545;
        }

        .alert.warning {
            background: #ffc107;
            color: #212529;
        }

        .alert.info {
            background: #17a2b8;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar-left { width: 250px; }
            .sidebar-right { width: 250px; }
        }

        @media (max-width: 768px) {
            .sidebar-left,
            .sidebar-right {
                position: fixed;
                top: 60px;
                bottom: 40px;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1500;
            }

            .sidebar-right {
                right: 0;
                transform: translateX(100%);
            }

            .sidebar-left.open {
                transform: translateX(0);
            }

            .sidebar-right.open {
                transform: translateX(0);
            }

            .header-left .logo {
                font-size: 1.2rem;
            }

            .website-selector {
                min-width: 150px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Header -->
    <div class="editor-header">
        <div class="header-left">
            <div class="logo">
                <i class="fas fa-paint-brush"></i>
                WebMaster Pro
            </div>
            <select class="website-selector" id="websiteSelector" onchange="loadSelectedWebsite()">
                <option value="">×‘×—×¨ ××ª×¨ ×œ×¢×¨×™×›×”...</option>
            </select>
        </div>
        <div class="header-actions">
            <button class="header-btn" onclick="toggleSidebar('left')">
                <i class="fas fa-bars"></i>
            </button>
            <button class="header-btn" onclick="saveWebsite()">
                <i class="fas fa-save"></i>
                ×©××•×¨
            </button>
            <button class="header-btn" onclick="previewWebsite()">
                <i class="fas fa-eye"></i>
                ×ª×¦×•×’×” ××§×“×™××”
            </button>
            <button class="header-btn" onclick="showSupabaseModal()">
                <i class="fas fa-database"></i>
                Supabase
            </button>
            <button class="header-btn primary" onclick="publishWebsite()">
                <i class="fas fa-rocket"></i>
                ×¤×¨×¡×
            </button>
        </div>
    </div>

    <div class="editor-container">
        <!-- Sidebar Left -->
        <div class="sidebar-left" id="sidebarLeft">
            <div class="sidebar-section">
                <div class="sidebar-title">
                    <i class="fas fa-tools"></i>
                    ×›×œ×™ ×¢×¨×™×›×”
                </div>
                <div class="tool-group">
                    <div class="tool-btn active" onclick="selectTool('select')">
                        <i class="fas fa-mouse-pointer"></i><br>×‘×—×™×¨×”
                    </div>
                    <div class="tool-btn" onclick="selectTool('text')">
                        <i class="fas fa-font"></i><br>×˜×§×¡×˜
                    </div>
                    <div class="tool-btn" onclick="selectTool('image')">
                        <i class="fas fa-image"></i><br>×ª××•× ×”
                    </div>
                    <div class="tool-btn" onclick="selectTool('layout')">
                        <i class="fas fa-th-large"></i><br>×¤×¨×™×¡×”
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">
                    <i class="fas fa-palette"></i>
                    ×¢×™×¦×•×‘
                </div>
                <div class="property-group">
                    <label class="property-label">×¦×‘×¢ ×¨×§×¢</label>
                    <input type="color" class="color-picker" id="bgColor" value="#ffffff" onchange="updateStyle('backgroundColor', this.value)">
                </div>
                <div class="property-group">
                    <label class="property-label">×¦×‘×¢ ×˜×§×¡×˜</label>
                    <input type="color" class="color-picker" id="textColor" value="#333333" onchange="updateStyle('color', this.value)">
                </div>
                <div class="slider-control">
                    <label>×©×§×™×¤×•×ª</label>
                    <input type="range" min="0" max="100" value="100" id="opacitySlider" onchange="updateStyle('opacity', this.value/100)">
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">
                    <i class="fas fa-text-height"></i>
                    ×˜×™×¤×•×’×¨×¤×™×”
                </div>
                <div class="property-group">
                    <label class="property-label">×’×•×“×œ ×¤×•× ×˜</label>
                    <input type="range" min="12" max="48" value="16" class="property-input" id="fontSize" onchange="updateStyle('fontSize', this.value + 'px')">
                </div>
                <div class="tool-group">
                    <div class="tool-btn" onclick="updateStyle('fontWeight', 'bold')">
                        <i class="fas fa-bold"></i><br>×¢×‘×”
                    </div>
                    <div class="tool-btn" onclick="updateStyle('fontStyle', 'italic')">
                        <i class="fas fa-italic"></i><br>× ×˜×•×™
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">
                    <i class="fas fa-layer-group"></i>
                    ×¨×›×™×‘×™×
                </div>
                <div class="tool-group">
                    <div class="tool-btn" onclick="addComponent('button')">
                        <i class="fas fa-square"></i><br>×›×¤×ª×•×¨
                    </div>
                    <div class="tool-btn" onclick="addComponent('text')">
                        <i class="fas fa-heading"></i><br>×›×•×ª×¨×ª
                    </div>
                    <div class="tool-btn" onclick="addComponent('image')">
                        <i class="fas fa-image"></i><br>×ª××•× ×”
                    </div>
                    <div class="tool-btn" onclick="addComponent('section')">
                        <i class="fas fa-th-large"></i><br>×—×œ×§
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Editor Area -->
        <div class="editor-main">
            <div class="editor-toolbar">
                <div class="view-controls">
                    <button class="view-btn active" onclick="switchView('visual')">
                        <i class="fas fa-eye"></i>
                        ×•×™×–×•××œ×™
                    </button>
                    <button class="view-btn" onclick="switchView('code')">
                        <i class="fas fa-code"></i>
                        ×§×•×“
                    </button>
                </div>
                <div class="device-controls">
                    <button class="device-btn active" data-device="desktop" onclick="switchDevice('desktop')">
                        <i class="fas fa-desktop"></i>
                    </button>
                    <button class="device-btn" data-device="tablet" onclick="switchDevice('tablet')">
                        <i class="fas fa-tablet-alt"></i>
                    </button>
                    <button class="device-btn" data-device="mobile" onclick="switchDevice('mobile')">
                        <i class="fas fa-mobile-alt"></i>
                    </button>
                </div>
            </div>
            
            <div class="editor-viewport" id="editorViewport">
                <div class="website-frame desktop" id="websiteFrame">
                    <iframe class="website-content" id="websiteContent" src="about:blank"></iframe>
                </div>
            </div>
        </div>

        <!-- Sidebar Right -->
        <div class="sidebar-right" id="sidebarRight">
            <div class="properties-section">
                <div class="sidebar-title">
                    <i class="fas fa-cog"></i>
                    ×××¤×™×™× ×™×
                </div>
                <div class="property-group">
                    <label class="property-label">ID ×¨×›×™×‘</label>
                    <input type="text" class="property-input" id="elementId" placeholder="××–×”×” ×”×¨×›×™×‘" readonly>
                </div>
                <div class="property-group">
                    <label class="property-label">×§×œ××¡ CSS</label>
                    <input type="text" class="property-input" id="elementClass" placeholder="×§×œ××¡×™×">
                </div>
                <div class="property-group">
                    <label class="property-label">×ª×•×›×Ÿ</label>
                    <textarea class="property-input" id="elementContent" rows="4" placeholder="×ª×•×›×Ÿ ×”×¨×›×™×‘"></textarea>
                </div>
            </div>

            <div class="properties-section">
                <div class="sidebar-title">
                    <i class="fas fa-ruler-combined"></i>
                    ××™×“×•×ª ×•××™×§×•×
                </div>
                <div class="property-group">
                    <label class="property-label">×¨×•×—×‘</label>
                    <input type="text" class="property-input" id="elementWidth" placeholder="auto">
                </div>
                <div class="property-group">
                    <label class="property-label">×’×•×‘×”</label>
                    <input type="text" class="property-input" id="elementHeight" placeholder="auto">
                </div>
                <div class="property-group">
                    <label class="property-label">××¨×•×•×— ×—×™×¦×•× ×™</label>
                    <input type="text" class="property-input" id="elementMargin" placeholder="0">
                </div>
                <div class="property-group">
                    <label class="property-label">××¨×•×•×— ×¤× ×™××™</label>
                    <input type="text" class="property-input" id="elementPadding" placeholder="0">
                </div>
            </div>

            <div class="properties-section">
                <div class="sidebar-title">
                    <i class="fas fa-chart-line"></i>
                    ×¡×˜×˜×™×¡×˜×™×§×•×ª
                </div>
                <div class="status-item">
                    <span class="property-label">×©×™× ×•×™×™×:</span>
                    <span id="changesCount">0</span>
                </div>
                <div class="status-item">
                    <span class="property-label">×©××™×¨×” ××—×¨×•× ×”:</span>
                    <span id="lastSave">-</span>
                </div>
                <div class="status-item">
                    <span class="property-label">×¡×˜×˜×•×¡:</span>
                    <span id="connectionStatus">×œ× ××—×•×‘×¨</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-left">
            <div class="status-item">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">××•×›×Ÿ</span>
            </div>
            <div class="status-item">
                <i class="fas fa-mouse-pointer"></i>
                <span id="selectedElement">×œ× × ×‘×—×¨ ×¨×›×™×‘</span>
            </div>
        </div>
        <div class="status-right">
            <div class="status-item">
                <span id="websiteInfo">×‘×—×¨ ××ª×¨ ×œ×¢×¨×™×›×”</span>
            </div>
        </div>
    </div>

    <!-- Supabase Configuration Modal -->
    <div class="modal" id="supabaseModal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-database"></i>
                ×”×’×“×¨×•×ª Supabase
            </div>
            <div class="form-group">
                <label class="form-label">Supabase URL</label>
                <input type="text" class="form-input" id="supabaseUrl" placeholder="https://your-project.supabase.co">
            </div>
            <div class="form-group">
                <label class="form-label">API Key (Anon Public)</label>
                <input type="text" class="form-input" id="supabaseKey" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="closeSupabaseModal()">×‘×™×˜×•×œ</button>
                <button class="modal-btn primary" onclick="connectSupabase()">×”×ª×—×‘×¨</button>
            </div>
        </div>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <script>
        // ===== Global Variables =====
        let currentWebsite = null;
        let selectedElement = null;
        let currentTool = 'select';
        let currentDevice = 'desktop';
        let currentView = 'visual';
        let websitesData = {};
        let supabaseClient = null;
        let isConnected = false;
        let changes = 0;
        let autoSaveInterval = null;

        // ===== Demo Websites Data =====
        const demoWebsitesData = {
            'dr-michal-rosen': {
                id: 'dr-michal-rosen',
                name: '×“"×¨ ××™×›×œ ×¨×•×–×Ÿ',
                category: '×¨×¤×•××” ××¡×ª×˜×™×ª',
                description: '×¨×•×¤××” ××¡×ª×˜×™×ª ××•××—×™×ª',
                image: 'https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=500',
                price: 'â‚ª2,800',
                status: '××•×›×Ÿ'
            },
            'fitness-co': {
                id: 'fitness-co',
                name: '×“× ×™ ×¤×™×˜',
                category: '×›×•×©×¨ ×•×‘×¨×™××•×ª',
                description: '××××Ÿ ×›×•×©×¨ ××™×©×™',
                image: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=500',
                price: 'â‚ª2,200',
                status: '××•×›×Ÿ'
            },
            'yoga-studio': {
                id: 'yoga-studio',
                name: '×¡×˜×•×“×™×• ××•×”×',
                category: '×™×•×’×” ×•××“×™×˜×¦×™×”',
                description: '×¡×˜×•×“×™×• ×™×•×’×” ×•××“×™×˜×¦×™×”',
                image: 'https://images.unsplash.com/photo-1506629905607-41bf6bb4ca4e?w=500',
                price: 'â‚ª1,900',
                status: '××•×›×Ÿ'
            },
            'nutritionist': {
                id: 'nutritionist',
                name: '×“"×¨ ×©×¨×” ×›×”×Ÿ',
                category: '×ª×–×•× ×”',
                description: '×ª×–×•× ××™×ª ×§×œ×™× ×™×ª',
                image: 'https://images.unsplash.com/photo-1505576399279-565b52d4ac71?w=500',
                price: 'â‚ª2,400',
                status: '××•×›×Ÿ'
            },
            'law-firm': {
                id: 'law-firm',
                name: '××©×¨×“ ×‘×¨×§×•×‘×™×¥',
                category: '××©×¤×˜×™×',
                description: '××©×¨×“ ×¢×•×¨×›×™ ×“×™×Ÿ',
                image: 'https://images.unsplash.com/photo-1589829545856-d10d557cf95f?w=500',
                price: 'â‚ª2,500',
                status: '××•×›×Ÿ'
            },
            'accountant': {
                id: 'accountant',
                name: '×¨×™× ×” ×œ×•×™',
                category: '×—×©×‘×•× ××•×ª',
                description: '×—×©×‘×ª ×©×›×¨',
                image: 'https://images.unsplash.com/photo-1554224155-6726b3ff858f?w=500',
                price: 'â‚ª2,000',
                status: '××•×›×Ÿ'
            },
            'beauty-salon': {
                id: 'beauty-salon',
                name: '××¡×¤×¨×” BELLA',
                category: '×™×•×¤×™ ×•×¢×™×¦×•×‘',
                description: '××¡×¤×¨×” ×•×™×•×¤×™',
                image: 'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=500',
                price: 'â‚ª1,700',
                status: '××•×›×Ÿ'
            },
            'tutor': {
                id: 'tutor',
                name: '×“"×¨ ×¨×•× ×™×ª ×œ×•×™',
                category: '×—×™× ×•×š',
                description: '××•×¨×” ×¤×¨×˜×™×ª',
                image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=500',
                price: 'â‚ª2,100',
                status: '××•×›×Ÿ'
            },
            'aesthetic-clinic': {
                id: 'aesthetic-clinic',
                name: '×§×œ×™× ×™×§×ª ×™×•×¤×™ ×¤×¨××™×•×',
                category: '××¡×ª×˜×™×§×” ×¨×¤×•××™×ª',
                description: '×§×œ×™× ×™×§×” ×œ××¡×ª×˜×™×§×” ×¨×¤×•××™×ª',
                image: 'https://images.unsplash.com/photo-1629909613654-28e377c37b09?w=500',
                price: 'â‚ª3,200',
                status: '××•×›×Ÿ'
            },
            'multibrawn': {
                id: 'multibrawn',
                name: '××•×œ×˜×™×‘×¨××•×Ÿ',
                category: '× ×•×¤×© ×•××™×¨×•×¢×™×',
                description: '××¨×›×– × ×•×¤×© ×•××™×¨×•×¢×™×',
                image: 'https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=500',
                price: 'â‚ª2,300',
                status: '×‘×¢×‘×•×“×”'
            },
            'real-estate': {
                id: 'real-estate',
                name: '× ×“×œ"×Ÿ ×¤×¨××™×•×',
                category: '× ×“×œ"×Ÿ',
                description: '××©×¨×“ × ×“×œ"×Ÿ ×™×•×§×¨×ª×™',
                image: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=500',
                price: 'â‚ª2,700',
                status: '××•×›×Ÿ'
            }
        };

        // ===== Initialization =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¨ WebMaster Pro Editor - ××˜×¢×™×Ÿ...');
            
            initializeEditor();
            populateWebsiteSelector();
            enableAutoSave();
            loadSupabaseSettings();
            
            console.log('âœ… WebMaster Pro Editor - ××•×›×Ÿ!');
        });

        function initializeEditor() {
            websitesData = { ...demoWebsitesData };
            updateStatus('××•×›×Ÿ', 'ready');
            updateChangesCount(0);
        }

        function populateWebsiteSelector() {
            const selector = document.getElementById('websiteSelector');
            selector.innerHTML = '<option value="">×‘×—×¨ ××ª×¨ ×œ×¢×¨×™×›×”...</option>';
            
            Object.values(websitesData).forEach(website => {
                const option = document.createElement('option');
                option.value = website.id;
                option.textContent = `${website.name} - ${website.category}`;
                selector.appendChild(option);
            });
        }

        // ===== Website Loading =====
        function loadSelectedWebsite() {
            const selector = document.getElementById('websiteSelector');
            const websiteId = selector.value;
            
            if (!websiteId) {
                currentWebsite = null;
                updateStatus('×‘×—×¨ ××ª×¨ ×œ×¢×¨×™×›×”', 'waiting');
                return;
            }
            
            currentWebsite = websitesData[websiteId];
            loadWebsiteInFrame(websiteId);
            updateStatus(`×¢×•×¨×š: ${currentWebsite.name}`, 'editing');
            updateWebsiteInfo();
        }

        function loadWebsiteInFrame(websiteId) {
            const iframe = document.getElementById('websiteContent');
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            showLoading(true);
            
            // ×™×¦×™×¨×ª HTML ×“××• ×¢×‘×•×¨ ×”××ª×¨
            const websiteHTML = generateDemoWebsiteHTML(websiteId);
            
            // ×˜×¢×™× ×ª ×”-HTML ×‘-iframe
            iframe.srcdoc = websiteHTML;
            
            iframe.onload = function() {
                showLoading(false);
                setupEditableElements();
                showAlert('×”××ª×¨ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”', 'success');
            };
        }

        function generateDemoWebsiteHTML(websiteId) {
            const website = websitesData[websiteId];
            
            return `
                <!DOCTYPE html>
                <html lang="he" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${website.name}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { 
                            font-family: 'Assistant', sans-serif; 
                            line-height: 1.6; 
                            color: #333;
                        }
                        .editable {
                            cursor: pointer;
                            transition: all 0.3s ease;
                            position: relative;
                        }
                        .editable:hover {
                            outline: 2px dashed #667eea;
                            outline-offset: 2px;
                        }
                        .editable.selected {
                            outline: 2px solid #667eea;
                            outline-offset: 2px;
                        }
                        .hero {
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            text-align: center;
                            padding: 100px 20px;
                        }
                        .hero h1 {
                            font-size: 3rem;
                            margin-bottom: 20px;
                        }
                        .hero p {
                            font-size: 1.2rem;
                            margin-bottom: 30px;
                        }
                        .btn {
                            background: #ff6b6b;
                            color: white;
                            padding: 15px 30px;
                            border: none;
                            border-radius: 50px;
                            font-size: 1.1rem;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        }
                        .btn:hover {
                            background: #ff5252;
                            transform: translateY(-2px);
                        }
                        .section {
                            padding: 80px 20px;
                            text-align: center;
                        }
                        .section h2 {
                            font-size: 2.5rem;
                            margin-bottom: 50px;
                            color: #333;
                        }
                        .services-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                            gap: 30px;
                            max-width: 1200px;
                            margin: 0 auto;
                        }
                        .service-card {
                            background: white;
                            padding: 40px 30px;
                            border-radius: 15px;
                            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                            transition: all 0.3s ease;
                        }
                        .service-card:hover {
                            transform: translateY(-10px);
                            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
                        }
                        .service-icon {
                            font-size: 3rem;
                            color: #667eea;
                            margin-bottom: 20px;
                        }
                        .service-card h3 {
                            font-size: 1.5rem;
                            margin-bottom: 15px;
                            color: #333;
                        }
                        .service-card p {
                            color: #666;
                            margin-bottom: 20px;
                        }
                        .price {
                            font-size: 1.3rem;
                            font-weight: 700;
                            color: #667eea;
                        }
                        .contact {
                            background: #f8f9fa;
                        }
                        .contact-form {
                            max-width: 600px;
                            margin: 0 auto;
                        }
                        .form-group {
                            margin-bottom: 20px;
                        }
                        .form-input {
                            width: 100%;
                            padding: 15px;
                            border: 1px solid #ddd;
                            border-radius: 8px;
                            font-size: 1rem;
                        }
                        .footer {
                            background: #333;
                            color: white;
                            text-align: center;
                            padding: 40px 20px;
                        }
                    </style>
                </head>
                <body>
                    <section class="hero editable" data-editable="true" data-type="section">
                        <h1 class="editable" data-editable="true" data-type="text">${website.name}</h1>
                        <p class="editable" data-editable="true" data-type="text">${website.description}</p>
                        <button class="btn editable" data-editable="true" data-type="button">×¦×•×¨ ×§×©×¨ ×¢×›×©×™×•</button>
                    </section>

                    <section class="section editable" data-editable="true" data-type="section">
                        <h2 class="editable" data-editable="true" data-type="text">×”×©×™×¨×•×ª×™× ×©×œ× ×•</h2>
                        <div class="services-grid">
                            <div class="service-card editable" data-editable="true" data-type="card">
                                <div class="service-icon editable" data-editable="true" data-type="icon">
                                    <i class="fas fa-star"></i>
                                </div>
                                <h3 class="editable" data-editable="true" data-type="text">×©×™×¨×•×ª ××§×¦×•×¢×™</h3>
                                <p class="editable" data-editable="true" data-type="text">×ª×™××•×¨ ×”×©×™×¨×•×ª ×”×¨××©×•×Ÿ</p>
                                <div class="price editable" data-editable="true" data-type="text">â‚ª500</div>
                            </div>
                            <div class="service-card editable" data-editable="true" data-type="card">
                                <div class="service-icon editable" data-editable="true" data-type="icon">
                                    <i class="fas fa-heart"></i>
                                </div>
                                <h3 class="editable" data-editable="true" data-type="text">×©×™×¨×•×ª ××™×›×•×ª×™</h3>
                                <p class="editable" data-editable="true" data-type="text">×ª×™××•×¨ ×”×©×™×¨×•×ª ×”×©× ×™</p>
                                <div class="price editable" data-editable="true" data-type="text">â‚ª750</div>
                            </div>
                            <div class="service-card editable" data-editable="true" data-type="card">
                                <div class="service-icon editable" data-editable="true" data-type="icon">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <h3 class="editable" data-editable="true" data-type="text">×©×™×¨×•×ª ××•×ª××</h3>
                                <p class="editable" data-editable="true" data-type="text">×ª×™××•×¨ ×”×©×™×¨×•×ª ×”×©×œ×™×©×™</p>
                                <div class="price editable" data-editable="true" data-type="text">â‚ª1,000</div>
                            </div>
                        </div>
                    </section>

                    <section class="section contact editable" data-editable="true" data-type="section">
                        <h2 class="editable" data-editable="true" data-type="text">×¦×•×¨ ×§×©×¨</h2>
                        <div class="contact-form">
                            <div class="form-group">
                                <input type="text" class="form-input editable" data-editable="true" data-type="input" placeholder="×©× ××œ×">
                            </div>
                            <div class="form-group">
                                <input type="email" class="form-input editable" data-editable="true" data-type="input" placeholder="××™××™×™×œ">
                            </div>
                            <div class="form-group">
                                <textarea class="form-input editable" data-editable="true" data-type="textarea" rows="5" placeholder="×”×•×“×¢×”"></textarea>
                            </div>
                            <button class="btn editable" data-editable="true" data-type="button">×©×œ×— ×”×•×“×¢×”</button>
                        </div>
                    </section>

                    <footer class="footer editable" data-editable="true" data-type="section">
                        <p class="editable" data-editable="true" data-type="text">Â© 2024 ${website.name}. ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª.</p>
                    </footer>

                    <script>
                        // ××™× ×˜×¨××§×¦×™×” ×¢× ×”××“×™×˜×•×¨ ×”×—×™×¦×•× ×™
                        document.addEventListener('click', function(e) {
                            if (e.target.hasAttribute('data-editable')) {
                                e.preventDefault();
                                e.stopPropagation();
                                
                                // ×”×¡×¨×ª ×‘×—×™×¨×” ×§×•×“××ª
                                document.querySelectorAll('.selected').forEach(el => {
                                    el.classList.remove('selected');
                                });
                                
                                // ×‘×—×™×¨×ª ×”××œ×× ×˜ ×”×—×“×©
                                e.target.classList.add('selected');
                                
                                // ×¢×“×›×•×Ÿ ×”××“×™×˜×•×¨ ×”×—×™×¦×•× ×™
                                parent.postMessage({
                                    type: 'elementSelected',
                                    element: {
                                        id: e.target.id || 'auto-' + Date.now(),
                                        tagName: e.target.tagName,
                                        className: e.target.className,
                                        content: e.target.textContent || e.target.value,
                                        type: e.target.getAttribute('data-type')
                                    }
                                }, '*');
                            }
                        });
                    </script>
                </body>
                </html>
            `;
        }

        function setupEditableElements() {
            const iframe = document.getElementById('websiteContent');
            
            // ×”××–× ×” ×œ×”×•×“×¢×•×ª ××”××ª×¨
            window.addEventListener('message', function(e) {
                if (e.data.type === 'elementSelected') {
                    handleElementSelection(e.data.element);
                }
            });
        }

        function handleElementSelection(element) {
            selectedElement = element;
            updateSelectedElementInfo(element);
            updatePropertiesPanel(element);
            updateStatus(`× ×‘×—×¨: ${element.tagName}`, 'editing');
        }

        function updateSelectedElementInfo(element) {
            document.getElementById('selectedElement').textContent = 
                `${element.tagName} - ${element.type || '×œ× ××•×’×“×¨'}`;
        }

        function updatePropertiesPanel(element) {
            document.getElementById('elementId').value = element.id || '';
            document.getElementById('elementClass').value = element.className || '';
            document.getElementById('elementContent').value = element.content || '';
        }

        // ===== Tool Selection =====
        function selectTool(tool) {
            currentTool = tool;
            
            // ×¢×“×›×•×Ÿ UI
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.tool-btn').classList.add('active');
            
            updateStatus(`×›×œ×™: ${getToolName(tool)}`, 'ready');
        }

        function getToolName(tool) {
            const names = {
                'select': '×‘×—×™×¨×”',
                'text': '×˜×§×¡×˜',
                'image': '×ª××•× ×”',
                'layout': '×¤×¨×™×¡×”'
            };
            return names[tool] || tool;
        }

        // ===== View Controls =====
        function switchView(view) {
            currentView = view;
            
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (view === 'code') {
                showCodeEditor();
            } else {
                showVisualEditor();
            }
        }

        function showCodeEditor() {
            // TODO: ×”×˜××¢×ª ××“×™×˜×•×¨ ×§×•×“
            showAlert('××“×™×˜×•×¨ ×§×•×“ ×™×•×©×œ× ×‘×§×¨×•×‘', 'info');
        }

        function showVisualEditor() {
            // ×—×–×¨×” ×œ××“×™×˜×•×¨ ×•×™×–×•××œ×™
            document.getElementById('websiteFrame').style.display = 'block';
        }

        function switchDevice(device) {
            currentDevice = device;
            const frame = document.getElementById('websiteFrame');
            
            // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™×
            document.querySelectorAll('.device-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-device="${device}"]`).classList.add('active');
            
            // ×¢×“×›×•×Ÿ ×’×•×“×œ ×”×¤×¨×™×™×
            frame.className = `website-frame ${device}`;
            
            updateStatus(`×ª×¦×•×’×”: ${getDeviceName(device)}`, 'ready');
        }

        function getDeviceName(device) {
            const names = {
                'desktop': '××—×©×‘',
                'tablet': '×˜××‘×œ×˜',
                'mobile': '× ×™×™×“'
            };
            return names[device] || device;
        }

        // ===== Style Updates =====
        function updateStyle(property, value) {
            if (!selectedElement) {
                showAlert('×œ× × ×‘×—×¨ ×¨×›×™×‘ ×œ×¢×¨×™×›×”', 'warning');
                return;
            }
            
            const iframe = document.getElementById('websiteContent');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const element = iframeDoc.querySelector('.selected');
            
            if (element) {
                element.style[property] = value;
                incrementChanges();
                showAlert(`×¢×•×“×›×Ÿ: ${property}`, 'success');
            }
        }

        function addComponent(type) {
            showAlert(`×”×•×¡×¤×ª ×¨×›×™×‘ ${type} ×ª×•×©×œ× ×‘×§×¨×•×‘`, 'info');
        }

        // ===== Sidebar Controls =====
        function toggleSidebar(side) {
            const sidebar = document.getElementById(`sidebar${side.charAt(0).toUpperCase() + side.slice(1)}`);
            sidebar.classList.toggle('open');
        }

        // ===== Save & Load =====
        function saveWebsite() {
            if (!currentWebsite) {
                showAlert('×œ× × ×‘×—×¨ ××ª×¨ ×œ×©××™×¨×”', 'warning');
                return;
            }
            
            showLoading(true);
            updateStatus('×©×•××¨...', 'saving');
            
            setTimeout(() => {
                showLoading(false);
                updateStatus('× ×©××¨ ×‘×”×¦×œ×—×”', 'ready');
                updateLastSave();
                showAlert('×”××ª×¨ × ×©××¨ ×‘×”×¦×œ×—×”', 'success');
                resetChanges();
            }, 1500);
        }

        function previewWebsite() {
            if (!currentWebsite) {
                showAlert('×œ× × ×‘×—×¨ ××ª×¨ ×œ×ª×¦×•×’×” ××§×“×™××”', 'warning');
                return;
            }
            
            const iframe = document.getElementById('websiteContent');
            const websiteHTML = iframe.srcdoc;
            
            const previewWindow = window.open('', '_blank');
            previewWindow.document.write(websiteHTML);
            previewWindow.document.close();
            
            showAlert('× ×¤×ª×—×ª ×ª×¦×•×’×” ××§×“×™××”', 'success');
        }

        function publishWebsite() {
            if (!currentWebsite) {
                showAlert('×œ× × ×‘×—×¨ ××ª×¨ ×œ×¤×¨×¡×•×', 'warning');
                return;
            }
            
            showAlert('×¤×¨×¡×•× ×”××ª×¨ ×™×•×©×œ× ×‘×§×¨×•×‘', 'info');
        }

        // ===== Supabase Integration =====
        function showSupabaseModal() {
            document.getElementById('supabaseModal').style.display = 'flex';
        }

        function closeSupabaseModal() {
            document.getElementById('supabaseModal').style.display = 'none';
        }

        function loadSupabaseSettings() {
            const savedUrl = localStorage.getItem('supabase_url');
            const savedKey = localStorage.getItem('supabase_key');
            
            if (savedUrl && savedKey) {
                document.getElementById('supabaseUrl').value = savedUrl;
                document.getElementById('supabaseKey').value = savedKey;
                // ××•×˜×•-×”×ª×—×‘×¨×•×ª
                connectSupabase();
            }
        }

        function connectSupabase() {
            const url = document.getElementById('supabaseUrl').value.trim();
            const key = document.getElementById('supabaseKey').value.trim();
            
            if (!url || !key) {
                showAlert('× × ×œ×”×›× ×™×¡ URL ×•-API Key', 'error');
                return;
            }
            
            showLoading(true);
            
            // ×©××™×¨×ª ×”×’×“×¨×•×ª
            localStorage.setItem('supabase_url', url);
            localStorage.setItem('supabase_key', key);
            
            // ×™×¦×™×¨×ª ×œ×§×•×— Supabase ×¤×©×•×˜
            supabaseClient = {
                url: url,
                key: key,
                async query(sql) {
                    // TODO: ×”×˜××¢×ª ×©××™×œ×ª×•×ª Supabase
                    return { data: [], error: null };
                }
            };
            
            setTimeout(() => {
                showLoading(false);
                isConnected = true;
                closeSupabaseModal();
                updateConnectionStatus(true);
                showAlert('×”×ª×—×‘×¨×•×ª ×œ-Supabase ×”×¦×œ×™×—×”', 'success');
            }, 2000);
        }

        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connectionStatus');
            statusElement.textContent = connected ? '××—×•×‘×¨ ×œ-Supabase' : '×œ× ××—×•×‘×¨';
            statusElement.style.color = connected ? '#28a745' : '#dc3545';
        }

        // ===== Auto Save =====
        function enableAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            
            autoSaveInterval = setInterval(() => {
                if (changes > 0 && currentWebsite) {
                    saveWebsite();
                }
            }, 30000); // ×©××™×¨×” ×›×œ 30 ×©× ×™×•×ª
        }

        // ===== Utility Functions =====
        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        function showAlert(message, type = 'info') {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.textContent = message;
            
            container.appendChild(alert);
            
            // ×”×¦×’×”
            setTimeout(() => {
                alert.classList.add('show');
            }, 100);
            
            // ×”×¡×¨×”
            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => {
                    container.removeChild(alert);
                }, 300);
            }, 3000);
        }

        function updateStatus(text, type = 'ready') {
            document.getElementById('statusText').textContent = text;
            const indicator = document.getElementById('statusIndicator');
            
            indicator.className = 'status-indicator';
            switch (type) {
                case 'saving':
                    indicator.classList.add('saving');
                    break;
                case 'error':
                    indicator.classList.add('error');
                    break;
                default:
                    // ×™×¨×•×§ ×¨×’×™×œ
                    break;
            }
        }

        function updateWebsiteInfo() {
            if (currentWebsite) {
                document.getElementById('websiteInfo').textContent = 
                    `${currentWebsite.name} - ${currentWebsite.category}`;
            }
        }

        function incrementChanges() {
            changes++;
            updateChangesCount(changes);
        }

        function resetChanges() {
            changes = 0;
            updateChangesCount(changes);
        }

        function updateChangesCount(count) {
            document.getElementById('changesCount').textContent = count;
        }

        function updateLastSave() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('he-IL');
            document.getElementById('lastSave').textContent = timeString;
        }

        // ===== Keyboard Shortcuts =====
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        saveWebsite();
                        break;
                    case 'p':
                        e.preventDefault();
                        previewWebsite();
                        break;
                }
            }
        });
    </script>
</body>
</html>
